var um_mailchimp_create_template=function(a,i){var t=wp.template(a),e="um_mailchimp_template_"+(new Date).getMilliseconds();return void 0===window.um_mailchimp_dashboard_data&&(window.um_mailchimp_dashboard_data={}),window.um_mailchimp_dashboard_data[e]={template:t,data:i},e},um_mailchimp_render_template=function(a,i){if(void 0!==window.um_mailchimp_dashboard_data[a]){var t=window.um_mailchimp_dashboard_data[a].template(window.um_mailchimp_dashboard_data[a].data);return void 0!==i&&(window.um_mailchimp_dashboard_data[a].object=i),window.um_mailchimp_dashboard_data[a].object.html(t),!0}return!1},um_mailchimp_update_template=function(a,i){if(i=i||{},void 0!==window.um_mailchimp_dashboard_data[a]){for(var t in i)window.um_mailchimp_dashboard_data[a].data[t]=i[t];return um_mailchimp_render_template(a)}return!1};window.um_sync_now=um_mailchimp_create_template("um-mailchimp-sync-metabox",um_mailchimp_data),um_mailchimp_render_template(window.um_sync_now,jQuery("#um-mailchimp-sync-metabox-wrapper")),jQuery(document).on("click","#btn_um_mailchimp_sync_now:not(.disabled)",function(a){a.preventDefault();var i=jQuery(".um_mailchimp_sync_list").val();um_mailchimp_update_template(window.um_sync_now,{button_disabled:!0,message:um_mailchimp_data.labels.sync_message,loading:!0,list:i});var t=[];i?t.push(i):jQuery(".um_mailchimp_sync_list option").each(function(){jQuery(this).val()&&t.push(jQuery(this).val())});var e=0;!function i(a){jQuery.post(wp.ajax.settings.url,{action:"um_mailchimp_sync_now",list:a,index:e,total:t.length,key:window.sync_key,nonce:um_admin_scripts.nonce},function(a){e+1<t.length&&setTimeout(function(){i(t[++e])},1e3),a.success?(window.sync_key=a.data.key,um_mailchimp_update_template(window.um_sync_now,{message:a.data.message,loading:e+1<t.length}),e+1===t.length&&setTimeout(function(){window.location=um_mailchimp_data.current_url},1e3)):alert(a.data)}).fail(function(a,i,t){alert(i+" "+t)})}(t[e]),window.sync_key=window.sync_key||""}),window.um_scan_now=um_mailchimp_create_template("um-mailchimp-subscribe-metabox",um_mailchimp_data),um_mailchimp_render_template(window.um_scan_now,jQuery("#um-mailchimp-subscribe-metabox-wrapper")),jQuery(document).on("click","#btn_um_mailchimp_scan_now:not(.disabled)",function(a){a.preventDefault();var i=jQuery(".um_mailchimp_user_role").val(),t=jQuery(".um_mailchimp_user_status").val();um_mailchimp_update_template(window.um_scan_now,{button_disabled:!0,message:um_mailchimp_data.labels.scan_message,loading:!0,role:i,status:t}),jQuery.post(wp.ajax.settings.url,{action:"um_mailchimp_scan_now",role:i,status:t,nonce:um_admin_scripts.nonce},function(a){a.success?(window.bulk_action={key:a.data.key,role:i,status:t},um_mailchimp_update_template(window.um_scan_now,{message:a.data.scan_total_message,loading:!1,step:2,button_disabled:!1})):alert(a.data)}).fail(function(a,i,t){alert(i+" "+t)})}),jQuery(document).on("click","#btn_um_mailchimp_bulk_subscribe:not(.disabled)",function(a){a.preventDefault();var t=[];jQuery(".um_mailchimp_list").val()?t.push(jQuery(".um_mailchimp_list").val()):jQuery(".um_mailchimp_list option").each(function(){jQuery(this).val()&&t.push(jQuery(this).val())}),um_mailchimp_update_template(window.um_scan_now,{button_disabled:!0,message:um_mailchimp_data.labels.start_bulk_subscribe_process,loading:!0,internal_lists:jQuery(".um_mailchimp_list").val()});var e=0;window.batch_ids=[],function i(a){jQuery.post(wp.ajax.settings.url,{action:"um_mailchimp_bulk_subscribe",list:a,index:e,total:t.length,key:window.bulk_action.key,role:window.bulk_action.role,status:window.bulk_action.status,nonce:um_admin_scripts.nonce},function(a){e+1<t.length&&setTimeout(function(){i(t[++e])},1e3),a.success?(window.batch_ids.push(a.data.batch_id),um_mailchimp_update_template(window.um_scan_now,{message:a.data.message,loading:e+1<t.length}),e+1===t.length&&setTimeout(function(){window.location=um_mailchimp_data.current_url},1e3)):alert(a.data)}).fail(function(a,i,t){alert(i+" "+t)})}(t[e])});